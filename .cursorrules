# NEXA Agent Rules

## HANDOFF (обязательно для Agent A)

После каждого изменения кода обновляй orchestrator/docs/HANDOFF.md по шаблону.
Без этого ответ считается неполным.

Шаблон HANDOFF.md:
- What changed
- Diff summary (список файлов)
- How to test (чеклист из docs/NEXA_TESTS.md)
- Risks

---

## Обязательное правило для NEXA_TL_PM

Перед любым финальным ответом, который содержит изменения кода:

1. Выполнить SELF-REVIEW CHECK:
   - Проверить глобальные команды (перебивают sticky?)
   - Проверить sticky аренды (не перехватывает возраст/переключения?)
   - Проверить quick_actions (клик отправляет текст?)
   - Проверить, что "Детские группы" только для детей
   - Проверить, что расписание читаемое и не одной строкой

2. В ответе обязательно вывести блок:
   SELF-REVIEW:
   - Глобальные команды: ✅/⚠️
   - Sticky аренды: ✅/⚠️
   - Quick_actions: ✅/⚠️
   - Детские группы: ✅/⚠️
   - Формат расписания: ✅/⚠️

3. Если есть риск — предложить минимальный безопасный фикс.

Нарушение этого правила считается неполным ответом.

## Обязательное правило для NEXA_REVIEW_QA

Каждое ревью должно включать:

1) Проверку регрессий независимо от diff:
   - Детские группы happy path до шага времени
   - Аренда happy path до "принято"
   - Глобальная команда "Расписание" внутри аренды (должна перебить sticky)
   - Команда "Возраст 6" внутри аренды (sticky не должен перехватить)

2) В ответе всегда требовать:
   - "Как тестировали" (если не приложено — считать это риском)
   - 2–4 шага проверки

3) Формат ответа строго:
   - что ок
   - риски
   - до 5 замечаний
   - ОДНА команда на исправление (файл/участок/что сделать)
   - как проверить

Если тестов не было — команда на исправление должна быть:
"Добавить/обновить тест-кейсы в docs/NEXA_TESTS.md и прогнать 4 ключевых теста".

**Handoff:** Agent B пишет замечания/одну команду в orchestrator/docs/HANDOFF.md (секция "Agent B: Review / Command") или в REVIEW.md.

## Branch policy
Все изменения делать в ветке dev (или feat/*).
Пуш в main запрещён. Main обновляется только владельцем проекта при релизе.

## Handoff & tests protocol (mandatory)
- Любое изменение кода требует обновления docs/HANDOFF.md.
- Любое изменение, влияющее на диалоги/интенты/приоритеты/quick_actions, требует прогона:
  BASE_URL=http://localhost:8001 npm run test:scenarios
- Если тесты не прогнаны — это должно быть явно указано как ⚠️ RISK.
- Пушить можно только в dev/feat ветки (main трогает только владелец при релизе).
