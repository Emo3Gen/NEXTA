# Танцуй со мной - Эмулятор v0.1.0

Продуктовый эмулятор для тестирования пользовательских сценариев без реальных чатов и DIKIDI.

## Структура проекта

- `chat-sim/` - Frontend веб-интерфейс
- `orchestrator/` - Backend API сервис
- `infra/` - Docker конфигурация

## Порты

**Важно:** Проект "Танцуй со мной" (NEXT) использует следующие порты:
- `http://localhost:8000` — эмулятор чатов (chat-sim)
- `http://localhost:8001` — orchestrator API

**Примечание:** 
- Порт 3000 занят другим проектом (Shiftledger) и не используется в этом проекте
- Проект "Танцуй со мной" (NEXT) использует порты 8000 и 8001

## Запуск

### Запуск через Docker (рекомендуется)

```bash
cd infra
docker compose up --build
```

После запуска:
- Эмулятор чатов: http://localhost:8000
- Orchestrator API: http://localhost:8001
- Health check: http://localhost:8001/health

### Локальный запуск (без Docker)

#### 1. Запуск orchestrator

```bash
cd orchestrator
npm install
npm start
```

Orchestrator будет доступен на `http://localhost:8001`

#### 2. Запуск chat-sim

Откройте файл `chat-sim/index.html` в браузере или используйте локальный сервер:

```bash
cd chat-sim
# Используйте любой простой HTTP сервер, например:
python3 -m http.server 8000
# или
npx serve -p 8000
```

Затем откройте `http://localhost:8000` в браузере.

## Функциональность

### Frontend (chat-sim)

- Селектор сценария (4 варианта)
- Кнопки быстрых действий (5 кнопок)
- Чат-интерфейс для текстовых сообщений
- Панель отладки с информацией о текущем состоянии

### Backend (orchestrator)

- Обработка POST запросов с расширенным форматом
- Определение intent на основе scenario и действия
- Генерация ответов без использования LLM
- Логирование всех запросов в консоль

## Формат запроса

```json
{
  "tenant_id": "studio_nexa",
  "channel": "simulator",
  "user_id": "test_user",
  "text": "...",
  "scenario": "...",
  "action_type": "button | text"
}
```

## Сценарии

1. **Запись на занятие** - предложение пробного занятия
2. **Детские группы** - вопрос про возраст
3. **Аренда зала** - вопрос про формат и количество людей
4. **Вопрос о тренере** - передача администратору

## Проблемы с портами (macOS)

Если при запуске Docker вы получаете ошибку о занятом порте:

1. **Проверьте, какие порты заняты:**
   ```bash
   lsof -i :8000
   lsof -i :8001
   ```

2. **Остановите процессы, использующие эти порты:**
   ```bash
   # Найти процесс
   lsof -ti :8000
   # Остановить процесс (замените PID на реальный)
   kill -9 <PID>
   ```

3. **Если порт 3000 занят Shiftledger:**
   - Это нормально, проект "Танцуй со мной" не использует порт 3000
   - Убедитесь, что Shiftledger работает на порту 3000
   - Проект "Танцуй со мной" использует порты 8000 и 8001

4. **Проверьте, что Docker контейнеры не конфликтуют:**
   ```bash
   docker ps
   docker stop <container_name>
   ```
